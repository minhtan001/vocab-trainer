<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vocab Trainer v5.1 ‚Äî GitHub Sync</title>
  <style>
    :root {
      --bg: #f4f6fb;
      --card: #ffffff;
      --muted: #6b7280;
      --accent: #2563eb;
    }

    * {
      box-sizing: border-box
    }

    body {
      margin: 0;
      font-family: Inter, Segoe UI, Roboto, Arial;
      background: var(--bg);
      color: #111;
    }

    .app {
      display: flex;
      min-height: 100vh
    }

    .sidebar {
      width: 320px;
      background: linear-gradient(180deg, #ffffff, #fbfdff);
      border-right: 1px solid #e6eef9;
      padding: 18px;
      height: 100vh;
      overflow-y: auto;
    }

    .brand {
      font-weight: 700;
      font-size: 18px;
      color: var(--accent);
      margin-bottom: 12px
    }

    .lists {
      margin-top: 10px
    }

    .list-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px;
      border-radius: 8px;
      cursor: pointer;
    }

    .list-item:hover {
      background: #f1f6ff
    }

    .list-item.active {
      background: linear-gradient(90deg, #eef6ff, #ffffff);
      border-left: 3px solid var(--accent);
      padding-left: 5px;
    }

    .controls {
      display: flex;
      gap: 8px;
      margin-top: 12px
    }

    .btn {
      background: var(--accent);
      color: #fff;
      border: none;
      padding: 8px 10px;
      border-radius: 8px;
      cursor: pointer;
    }

    .btn.alt {
      background: #e6eef9;
      color: var(--accent)
    }

    main {
      flex: 1;
      padding: 20px
    }

    .card {
      background: var(--card);
      border-radius: 12px;
      padding: 14px;
      box-shadow: 0 1px 4px rgba(16, 24, 40, 0.04);
      margin-bottom: 14px;
    }

    h2 {
      margin: 0 0 8px 0
    }

    .word-table {
      width: 100%;
      border-collapse: collapse;
      display: block;
      max-height: 500px;
      overflow-y: auto;
    }

    table th,
    table td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid #f1f5f9;
    }

    .small {
      font-size: 13px;
      color: var(--muted)
    }

    input[type=text],
    textarea,
    select {
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #dbeafe;
      width: 100%;
    }

    .flex {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .right {
      margin-left: auto
    }

    .chip {
      padding: 6px 8px;
      border-radius: 999px;
      background: #f1f5f9;
      font-size: 13px
    }

    .toggle {
      display: inline-flex;
      align-items: center;
      gap: 8px
    }

    .learn-controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap
    }

    .hidden {
      display: none
    }

    .footer {
      font-size: 13px;
      color: var(--muted);
      margin-top: 10px
    }

    @media(max-width:900px) {
      .app {
        flex-direction: column;
        min-height: 100vh;
      }

      .sidebar {
        width: 100%;
        height: auto;
        border-right: none;
        border-bottom: 1px solid #e6eef9;
        padding: 12px;
        position: static;
      }

      main {
        padding: 10px;
      }

      .card {
        padding: 10px;
        margin-bottom: 10px;
      }

      .word-table {
        max-height: 300px;
        font-size: 15px;
      }

      .modal-card {
        width: 98vw;
        max-width: 98vw;
        padding: 10px;
      }

      .lists,
      .controls,
      .learn-controls {
        flex-direction: column;
        gap: 6px;
      }

      .right {
        margin-left: 0;
        margin-top: 8px;
      }

      input[type=text],
      textarea,
      select {
        font-size: 16px;
        padding: 10px;
      }

      button.btn,
      button.btn.alt {
        width: 100%;
        margin-bottom: 6px;
        font-size: 16px;
        padding: 10px 0;
      }
    }

    /* Th√™m cho m√†n h√¨nh r·∫•t nh·ªè */
    @media (max-width: 600px) {
      .modal-card {
        width: 100vw;
        max-width: 100vw;
        padding: 6px;
      }

      .card {
        padding: 6px;
      }

      .word-table {
        font-size: 13px;
      }

      h2,
      h3 {
        font-size: 18px;
      }
    }

    .lang-select {
      float: right
    }

    .toast {
      position: fixed;
      right: 18px;
      bottom: 18px;
      background: #111;
      color: #fff;
      padding: 10px 14px;
      border-radius: 8px;
      opacity: 0;
      transform: translateY(8px);
      transition: all .28s ease;
      pointer-events: none;
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0)
    }

    .action-btn {
      padding: 6px 8px;
      border-radius: 6px;
      border: none;
      cursor: pointer
    }

    .action-small {
      font-size: 13px
    }

    .modal {
      position: fixed;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.35)
    }

    .modal.hidden {
      display: none !important;
    }

    .modal-card {
      background: white;
      padding: 18px;
      border-radius: 10px;
      width: 520px;
      max-width: 95%;
    }

    .muted-note {
      font-size: 13px;
      color: #6b7280
    }

    code {
      background: #f1f5f9;
      padding: 2px 4px;
      border-radius: 4px;
      font-size: 13px
    }

    .toggle.small input {
      width: 16px;
      height: 16px;
      vertical-align: middle;
      margin-right: 4px;
    }

    /* S·ª≠a layout Add/Edit khi m√†n h√¨nh nh·ªè */
    @media (max-width: 900px) {
      #manageArea > div[style*="display:grid"] {
        display: block !important;
        grid-template-columns: none !important;
        gap: 0 !important;
      }
    }
  </style>
</head>

<body>
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div style="display:flex;align-items:center;justify-content:space-between">
        <div class="brand">Vocab Trainer v5</div>
        <div class="lang-select">
          <select id="uiLang">
            <option value="en">EN</option>
            <option value="vi">VI</option>
          </select>
        </div>
      </div>

      <div><strong id="lblLists">Lists</strong></div>
      <div class="lists" id="lists"></div>
      <div style="margin-top:12px">
        <input id="newListName" placeholder="New list name" />
        <div class="controls">
          <button class="btn" id="createListBtn">Create</button>
          <button class="btn alt" id="importBtn">Import JSON</button>
        </div>
      </div>
      <div style="margin-top:14px">
        <button class="btn" id="connectGithubBtn">üîó Connect GitHub</button>
        <button class="btn alt" id="syncNowBtn">üíæ Sync Now</button>
        <div id="githubStatus" class="small muted-note" style="margin-top:8px">Not connected</div>
      </div>
      <div class="footer" id="footerTip">
        Tip: With GitHub Sync enabled, data file lives in your repo at <code>data/vocab_data.json</code>.
      </div>
    </aside>

    <!-- Main Content -->
    <main>
      <!-- List Controls -->
      <div class="card">
        <div style="display:flex;align-items:center;gap:12px">
          <div>
            <h2 id="currentListTitle">(no list)</h2>
            <div class="small" id="listMeta">Select or create a list to begin</div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <label class="small">Mode:
              <select id="modeSelect">
                <option value="listening">Listening</option>
                <option value="writing">Writing</option>
                <option value="review">Review Learned</option>
                <option value="mixed">Mixed</option>
              </select>
            </label>
            <label class="small"><input type="checkbox" id="excludeDisabled" checked /> Exclude disabled</label>
            <label class="small"><input type="checkbox" id="randomize" checked /> Randomize</label>
            <button class="btn" id="startLearningBtn" disabled>Start Learning</button>
            <button class="btn alt" id="exportBtn">Export JSON</button>
          </div>
        </div>
      </div>

      <!-- Manage Area -->
      <div class="card" id="manageArea">
        <div style="display:flex;gap:12px;align-items:center">
          <div style="flex:1">
            <h3 id="lblWords">Words</h3>
            <div class="small" id="lblWordsDesc">Add, edit, toggle include/learned status for each word.</div>
          </div>
          <div style="display:flex;gap:8px">
            <label class="toggle small"><input type="checkbox" id="showOnlyEnabled" checked /> <span id="lblShowOnlyEnabled">Show only enabled</span></label>
            <label class="toggle small"><input type="checkbox" id="showOnlyUnlearned" /> <span id="lblShowOnlyUnlearned">Show only unlearned</span></label>
          </div>
        </div>
        <div style="margin-top:12px;display:grid;grid-template-columns:1fr 300px;gap:12px">
          <div>
            <table class="word-table" id="wordsTable">
              <thead>
                <tr>
                  <th id="thWord">Word</th>
                  <th id="thMeaning">Meaning (VI)</th>
                  <th class="small" id="thStreak">Streak</th>
                  <th class="small" id="thLearned">Learned</th>
                  <th class="small" id="thEnabled">Enabled</th>
                  <th class="small">Actions</th>
                </tr>
              </thead>
              <tbody id="wordsTbody"></tbody>
            </table>
          </div>
          <div>
            <div style="margin-bottom:8px"><strong id="lblAddEdit">Add / Edit</strong></div>
            <input id="wordInput" placeholder="English word" />
            <div style="height:8px"></div>
            <input id="meaningInput" placeholder="Meaning (Vietnamese) ‚Äî leave empty to auto-translate" />
            <div style="height:8px"></div>
            <div style="display:flex;gap:8px">
              <button class="btn" id="addWordBtn">Add</button>
              <button class="btn alt" id="updateWordBtn" disabled>Update</button>
              <button class="btn alt" id="resetAllProgressBtn">Reset all progress</button>
            </div>
            <div style="height:10px"></div>
            <div>
              <strong id="lblOptions">Options</strong>
              <div class="small" style="margin-top:6px">Show meaning during learning: <label class="toggle"><input type="checkbox" id="showMeaningDuringStudy" checked /></label></div>
              <div class="small" style="margin-top:6px">Correct streak to mark learned: <input id="streakNeeded" type="number" min="1" max="10" value="3" style="width:60px" /></div>
              <div style="height:10px"></div>
              <div class="small">Export/Import list JSON:</div>
              <textarea id="exportArea" rows="6" style="width:100%;margin-top:6px" placeholder='Exported JSON appears here'></textarea>
              <div style="display:flex;gap:8px;margin-top:6px">
                <button class="btn alt" id="copyExportBtn">Copy</button>
                <button class="btn" id="applyImportBtn">Apply Import</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Learning Area -->
      <div class="card" id="learningArea" style="display:none">
        <h3 id="lblLearningSession">Learning Session</h3>
        <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
          <div class="right"><button class="btn" id="stopSessionBtn">Stop</button></div>
        </div>
        <div style="margin-top:12px">
          <div class="card">
            <div style="display:flex;align-items:center;gap:12px">
              <div style="flex:1">
                <div class="small">Progress</div>
                <div id="sessionProgress">0 / 0</div>
              </div>
              <div style="text-align:right">
                <button class="btn alt" id="playWordBtn">üîä Play</button>
                <button class="btn" id="markCorrectBtn">Mark Correct</button>
                <button class="btn alt" id="markWrongBtn">Mark Wrong</button>
              </div>
            </div>
            <div style="margin-top:12px">
              <div style="font-size:22px;font-weight:600" id="studyWord">‚Äî</div>
              <div class="small" id="studyMeaning" style="margin-top:6px; color:var(--muted)"></div>
              <div style="height:8px"></div>
              <input id="studyAnswer" autocomplete="off" placeholder="Type the word you hear and press Enter" />
            </div>
            <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
              <div id="sessionResult" class="small"></div>
              <div class="right" id="sessionControls"></div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast"></div>

  <!-- GitHub Connect Modal -->
  <div id="githubModal" class="modal hidden">
    <div class="modal-card">
      <h3>Connect to GitHub</h3>
      <div class="small muted-note">
        We'll read/write <code>data/vocab_data.json</code> in your repo. Provide a personal access token with <code>contents: write</code> permission.
      </div>
      <div style="height:10px"></div>
      <label>GitHub username</label>
      <input id="ghUser" placeholder="username">
      <label>Repository name</label>
      <input id="ghRepo" placeholder="vocab-trainer">
      <label>Branch</label>
      <input id="ghBranch" placeholder="main" value="main">
      <label>Personal Access Token (PAT)</label>
      <input id="ghToken" placeholder="ghp_..." type="password">
      <div style="height:10px"></div>
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button class="btn alt" id="ghCancel">Cancel</button>
        <button class="btn" id="ghSave">Save & Connect</button>
      </div>
    </div>
  </div>

  <!-- Wrong Words Modal -->
  <div id="wrongWordsModal" class="modal hidden">
    <div class="modal-card">
      <h3>Words you got wrong</h3>
      <div id="wrongWordsList"></div>
      <div style="margin-top:10px;display:flex;gap:8px;justify-content:flex-end">
        <button class="btn alt" id="closeWrongWordsBtn">Close</button>
        <button class="btn" id="retryWrongWordsBtn">Retry Wrong Words</button>
      </div>
    </div>
  </div>

  <!-- Main Script -->
  <script>
    // --- Constants & UI Text ---
    const STORAGE_KEY = 'vocabTrainer_v5_data_v1';
    const LANG_KEY = 'vocabTrainer_v5_uiLang';
    const GH_KEY = 'vocabTrainer_v5_github';
    const DATA_PATH = 'data/vocab_data.json';
    const LANG_UI = {
      en: {
        lblLists: 'Lists',
        lblWords: 'Words',
        lblWordsDesc: 'Add, edit, toggle include/learned status for each word.',
        lblAddEdit: 'Add / Edit',
        lblShowOnlyEnabled: 'Show only enabled',
        lblShowOnlyUnlearned: 'Show only unlearned',
        lblLearningSession: 'Learning Session',
        lblOptions: 'Options',
        startLearningBtn: 'Start Learning'
      },
      vi: {
        lblLists: 'Danh s√°ch',
        lblWords: 'T·ª´ v·ª±ng',
        lblWordsDesc: 'Th√™m, s·ª≠a, b·∫≠t/t·∫Øt h·ªçc cho t·ª´ng t·ª´.',
        lblAddEdit: 'Th√™m / S·ª≠a',
        lblShowOnlyEnabled: 'Ch·ªâ hi·ªÉn th·ªã t·ª´ ƒëang h·ªçc',
        lblShowOnlyUnlearned: 'Ch·ªâ hi·ªÉn th·ªã t·ª´ ch∆∞a h·ªçc',
        lblLearningSession: 'Bu·ªïi h·ªçc',
        lblOptions: 'T√πy ch·ªçn',
        startLearningBtn: 'B·∫Øt ƒë·∫ßu h·ªçc'
      }
    };

    document.getElementById('uiLang').addEventListener('change', e => {
      const lang = e.target.value;
      localStorage.setItem(LANG_KEY, lang);
      applyLang(lang);
    });

    function applyLang(lang) {
      const L = LANG_UI[lang];
      if (!L) return;
      const map = {
        lblLists: 'lblLists', lblWords: 'lblWords', lblWordsDesc: 'lblWordsDesc',
        lblAddEdit: 'lblAddEdit', lblShowOnlyEnabled: 'lblShowOnlyEnabled',
        lblShowOnlyUnlearned: 'lblShowOnlyUnlearned', lblLearningSession: 'lblLearningSession',
        lblOptions: 'lblOptions', startLearningBtn: 'startLearningBtn'
      };
      for (const [key, id] of Object.entries(map)) {
        const el = document.getElementById(id);
        if (el && L[key]) el.textContent = L[key];
      }
    }
    const savedLang = localStorage.getItem(LANG_KEY) || 'en';
    document.getElementById('uiLang').value = savedLang;
    applyLang(savedLang);

    // --- State ---
    let data = { lists: [] };
    let currentListId = null;
    let editingWordId = null;
    let session = null;
    let lastWord = null; // Bi·∫øn l∆∞u t·ª´ v·ª´a h·ªçc
    let wrongWords = []; // L∆∞u t·ª´ sai trong session

    // --- GitHub API ---
    function getGitHubConfig() { try { return JSON.parse(localStorage.getItem(GH_KEY) || 'null'); } catch (e) { return null; } }
    function saveGitHubConfig(cfg) { localStorage.setItem(GH_KEY, JSON.stringify(cfg)); }

    // --- local data ---
    function saveDataLocal() { localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }
    function loadDataLocal() { const raw = localStorage.getItem(STORAGE_KEY); if (raw) { try { data = JSON.parse(raw); } catch (e) { console.error('Invalid local data'); data = { lists: [] }; } } if (!data.lists) data.lists = []; }

    function uid(prefix = 'id') { return prefix + '_' + Math.random().toString(36).slice(2, 9); }
    function showToast(text) { const t = document.getElementById('toast'); t.textContent = text; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 2200); }

    const listsDiv = document.getElementById('lists');
    const currentListTitle = document.getElementById('currentListTitle');
    const listMeta = document.getElementById('listMeta');
    const wordsTbody = document.getElementById('wordsTbody');

    const UI_TEXT = {
      en: {
        notConnected: 'Not connected',
        connected: 'Connected to GitHub',
        resetSingle: 'Progress reset for'
      },
      vi: {
        notConnected: 'Ch∆∞a k·∫øt n·ªëi',
        connected: 'ƒê√£ k·∫øt n·ªëi GitHub',
        resetSingle: 'ƒê√£ ƒë·∫∑t l·∫°i ti·∫øn ƒë·ªô cho'
      }
    };

    // --- GitHub API helpers ---
    async function ghGetFile(username, repo, branch, path, token) {
      const url = `https://api.github.com/repos/${username}/${repo}/contents/${path}?ref=${branch}`;
      const res = await fetch(url, { headers: token ? { Authorization: 'token ' + token } : {} });
      if (res.status === 404) return null;
      if (!res.ok) throw new Error('GitHub API error: ' + res.status);
      return await res.json();
    }

    // --- Fixed ghPutFile: handles 409 Conflict gracefully ---
    async function ghPutFile(username, repo, branch, path, token, contentStr, message) {
      // always refresh SHA before writing
      let get = await ghGetFile(username, repo, branch, path, token);
      const url = `https://api.github.com/repos/${username}/${repo}/contents/${path}`;
      const body = {
        message: message || 'Update vocab data',
        content: btoa(unescape(encodeURIComponent(contentStr))),
        branch
      };
      if (get && get.sha) body.sha = get.sha;

      let res = await fetch(url, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json', Authorization: 'token ' + token },
        body: JSON.stringify(body)
      });

      // üåÄ retry once if conflict (409)
      if (res.status === 409) {
        console.warn('409 Conflict ‚Äî refreshing SHA and retrying...');
        get = await ghGetFile(username, repo, branch, path, token);
        body.sha = get ? get.sha : undefined;
        res = await fetch(url, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json', Authorization: 'token ' + token },
          body: JSON.stringify(body)
        });
      }

      if (!res.ok) {
        const txt = await res.text();
        throw new Error('GitHub PUT error: ' + res.status + ' ' + txt);
      }
      return await res.json();
    }

    // --- Connect UI ---
    const githubModal = document.getElementById('githubModal');
    document.getElementById('connectGithubBtn').onclick = () => {
      const cfg = getGitHubConfig() || {};
      document.getElementById('ghUser').value = cfg.username || '';
      document.getElementById('ghRepo').value = cfg.repo || 'vocab-trainer';
      document.getElementById('ghBranch').value = cfg.branch || 'main';
      document.getElementById('ghToken').value = cfg.token || '';
      githubModal.classList.remove('hidden');
    }
    document.getElementById('ghCancel').onclick = () => { githubModal.classList.add('hidden'); };
    document.getElementById('ghSave').onclick = async () => {
      const username = document.getElementById('ghUser').value.trim();
      const repo = document.getElementById('ghRepo').value.trim();
      const branch = document.getElementById('ghBranch').value.trim() || 'main';
      const token = document.getElementById('ghToken').value.trim();
      if (!username || !repo || !token) return alert('Please fill username, repo, and token.');
      try {
        const r = await ghGetFile(username, repo, branch, DATA_PATH, token);
        saveGitHubConfig({ username, repo, branch, token });
        updateGithubStatus(true);
        githubModal.classList.add('hidden'); // moved after status update

        if (r && r.content) {
          const remoteStr = decodeURIComponent(escape(atob(r.content.replace(/\n/g, ''))));
          const backupKey = STORAGE_KEY + '_backup_' + new Date().toISOString();
          localStorage.setItem(backupKey, localStorage.getItem(STORAGE_KEY) || '');
          try {
            const remoteObj = JSON.parse(remoteStr);
            data = remoteObj;
            saveDataLocal();
            renderAll();
            showToast('Loaded remote data');
            githubModal.classList.add('hidden');
          } catch (e) {
            showToast('Remote JSON parse error');
          }
        } else {
          await pushToGitHub('Initial commit: create data file');
          showToast('Created data file on GitHub');
        }
      } catch (e) {
        alert('GitHub connection failed: ' + e.message);
        updateGithubStatus(false);
      }
    }

    function updateGithubStatus(connected) {
      const cfg = getGitHubConfig();
      const status = document.getElementById('githubStatus');
      const lang = localStorage.getItem(LANG_KEY) || 'en';
      if (connected && cfg) {
        status.textContent = UI_TEXT[lang].connected + ` ‚Äî ${cfg.username}/${cfg.repo}@${cfg.branch}`;
      } else {
        status.textContent = UI_TEXT[lang].notConnected;
      }
    }

    async function pushToGitHub(message) {
      const cfg = getGitHubConfig();
      if (!cfg) throw new Error('No GitHub config');
      const contentStr = JSON.stringify(data, null, 2);
      return await ghPutFile(cfg.username, cfg.repo, cfg.branch, DATA_PATH, cfg.token, contentStr, message);
    }

    document.getElementById('syncNowBtn').onclick = async () => {
      const cfg = getGitHubConfig();
      if (!cfg) return alert('Not connected to GitHub');
      try {
        await pushToGitHub('Sync from web app');
        showToast('Synced to GitHub');
      } catch (e) {
        alert('Sync failed: ' + e.message);
      }
    }

    // --- core app logic ---
    function renderLists() {
      listsDiv.innerHTML = '';
      data.lists.forEach(l => {
        const el = document.createElement('div');
        el.className = 'list-item' + (l.id === currentListId ? ' active' : '');
        el.onclick = () => { currentListId = l.id; renderAll(); };
        el.innerHTML = `<div style="display:flex;gap:8px;align-items:center"><strong>${escapeHtml(l.name)}</strong><div class="small chip">${l.words.length} words</div></div>
        <div style="display:flex;gap:6px"><button class="btn alt" onclick="event.stopPropagation();renameList('${l.id}')">Rename</button><button class="btn alt" style="background:#fee7e7;color:#b91c1c" onclick="event.stopPropagation();deleteList('${l.id}')">Delete</button></div>`;
        listsDiv.appendChild(el);
      });
    }
    function renameList(id) {
      const name = prompt('New list name:');
      if (name) {
        const l = data.lists.find(x => x.id === id);
        if (l) {
          l.name = name;
          saveDataLocal();
          renderAll();
        }
      }
    }
    function deleteList(id) {
      if (!confirm('Delete this list?')) return;
      data.lists = data.lists.filter(x => x.id !== id);
      if (currentListId === id) currentListId = data.lists.length ? data.lists[0].id : null;
      saveDataLocal();
      renderAll();
    }

    function renderAll() {
      renderLists();
      renderCurrentList();
      updateGithubStatus(!!getGitHubConfig());
    }
    function renderCurrentList() {
      const list = data.lists.find(x => x.id === currentListId);
      if (!list) {
        currentListTitle.textContent = '(no list)';
        listMeta.textContent = 'Select or create a list to begin';
        document.getElementById('startLearningBtn').disabled = true;
        wordsTbody.innerHTML = '';
        return;
      }
      currentListTitle.textContent = list.name;
      listMeta.textContent = `${list.words.length} words in this list`;
      document.getElementById('startLearningBtn').disabled = list.words.length === 0;
      const showOnlyEnabled = document.getElementById('showOnlyEnabled').checked;
      const showOnlyUnlearned = document.getElementById('showOnlyUnlearned').checked;
      wordsTbody.innerHTML = '';
      list.words.forEach(w => {
        if (showOnlyEnabled && !w.enabled) return;
        if (showOnlyUnlearned && w.learned) return;
        const tr = document.createElement('tr');
        tr.innerHTML = `
  <td>${escapeHtml(w.word)}</td>
  <td>${escapeHtml(w.meaning)}</td>
  <td class="small">${w.correctStreak}</td>
  <td class="small">${w.learned ? 'Yes' : 'No'}</td>
  <td class="small">
    <label class="toggle small">
      <input type="checkbox" ${w.enabled ? 'checked' : ''} onchange="toggleEnabled('${w.id}', this.checked)">
      ${w.enabled ? 'On' : 'Off'}
    </label>
  </td>
  <td style="text-align:right">
    <button class='action-btn action-small' onclick="editWord('${w.id}')">‚úèÔ∏è</button>
    <button class='action-btn action-small' onclick="deleteWord('${w.id}')">‚ùå</button>
    <button class='action-btn action-small' onclick="resetWordProgress('${w.id}')">‚ôªÔ∏è</button>
  </td>`;
        wordsTbody.appendChild(tr);
      });
    }

    function editWord(wordId) {
      const list = data.lists.find(x => x.id === currentListId);
      const w = list.words.find(x => x.id === wordId);
      if (!w) return;
      editingWordId = w.id;
      document.getElementById('wordInput').value = w.word;
      document.getElementById('meaningInput').value = w.meaning;
      document.getElementById('updateWordBtn').disabled = false;
      document.getElementById('addWordBtn').disabled = true;
    }
    function deleteWord(wordId) {
      if (!confirm('Delete this word?')) return;
      const list = data.lists.find(x => x.id === currentListId);
      list.words = list.words.filter(x => x.id !== wordId);
      saveDataLocal();
      //try{ const cfg = getGitHubConfig(); if(cfg) pushToGitHub('Delete a word'); }catch(e){} 
      renderCurrentList();
    }

    function resetWordProgress(wordId) {
      const list = data.lists.find(x => x.id === currentListId);
      const w = list.words.find(x => x.id === wordId);
      if (!w) return;
      w.correctStreak = 0;
      w.learned = false;
      saveDataLocal();
      renderCurrentList();
      const lang = localStorage.getItem(LANG_KEY) || 'en';
      showToast((lang === 'vi' ? UI_TEXT.vi.resetSingle : UI_TEXT.en.resetSingle) + ` "${w.word}"`);
      //try{ const cfg = getGitHubConfig(); if(cfg) pushToGitHub('Reset single word progress'); }catch(e){} 
    }

    document.getElementById('createListBtn').onclick = () => {
      const name = document.getElementById('newListName').value.trim();
      if (!name) return alert('Enter a list name');
      const id = uid('list');
      data.lists.push({ id, name, words: [] });
      document.getElementById('newListName').value = '';
      saveDataLocal();
      currentListId = id;
      renderAll();
    }

    async function autoTranslateToVI(text) {
      try {
        const url = 'https://api.mymemory.translated.net/get?q=' + encodeURIComponent(text) + '&langpair=en|vi';
        const res = await fetch(url);
        if (!res.ok) throw new Error('Network');
        const j = await res.json();
        const trans = j && j.responseData && j.responseData.translatedText ? j.responseData.translatedText : '';
        return trans || '';
      } catch (e) { console.warn('Auto-translate failed', e); return ''; }
    }

    document.getElementById('addWordBtn').onclick = async () => {
      const wv = document.getElementById('wordInput').value.trim();
      let mv = document.getElementById('meaningInput').value.trim();
      if (!wv) return alert('Enter a word');
      const list = data.lists.find(x => x.id === currentListId);
      if (!list) return alert('Select a list');
      if (!mv) {
        document.getElementById('meaningInput').placeholder = 'Translating...';
        mv = await autoTranslateToVI(wv);
        document.getElementById('meaningInput').placeholder = 'Meaning (Vietnamese) ‚Äî leave empty to auto-translate';
      }
      list.words.push({ id: uid('w'), word: wv, meaning: mv, correctStreak: 0, learned: false, enabled: true });
      saveDataLocal();
      renderCurrentList();
      document.getElementById('wordInput').value = '';
      document.getElementById('meaningInput').value = '';
      showToast('Word added');
      //try{ const cfg = getGitHubConfig(); if(cfg) await pushToGitHub('Add word'); showToast('Synced to GitHub'); }catch(e){}
    }

    document.getElementById('updateWordBtn').onclick = async () => {
      if (!editingWordId) return;
      const list = data.lists.find(x => x.id === currentListId);
      const w = list.words.find(x => x.id === editingWordId);
      w.word = document.getElementById('wordInput').value.trim();
      w.meaning = document.getElementById('meaningInput').value.trim();
      editingWordId = null;
      document.getElementById('updateWordBtn').disabled = true;
      document.getElementById('addWordBtn').disabled = false;
      saveDataLocal();
      renderCurrentList();
      document.getElementById('wordInput').value = '';
      document.getElementById('meaningInput').value = '';
      showToast('Word updated');
      //try{ const cfg = getGitHubConfig(); if(cfg) await pushToGitHub('Update word'); showToast('Synced to GitHub'); }catch(e){}
    }

    document.getElementById('resetAllProgressBtn').onclick = () => {
      if (!confirm('Reset progress for this list?')) return;
      const list = data.lists.find(x => x.id === currentListId);
      list.words.forEach(w => { w.correctStreak = 0; w.learned = false; });
      saveDataLocal();
      renderCurrentList();
      showToast('All progress reset');
      //try{ const cfg = getGitHubConfig(); if(cfg) pushToGitHub('Reset all progress'); }catch(e){} 
    }

    document.getElementById('exportBtn').onclick = () => {
      const list = data.lists.find(x => x.id === currentListId);
      if (!list) return alert('Select a list');
      const txt = JSON.stringify(list, null, 2);
      const a = document.createElement('a');
      const blob = new Blob([txt], { type: 'application/json' });
      a.href = URL.createObjectURL(blob);
      a.download = (list.name || 'list') + '.json';
      a.click();
      showToast('Exported');
    }

    document.getElementById('copyExportBtn').addEventListener('click', () => {
      const ta = document.getElementById('exportArea');
      ta.select();
      document.execCommand('copy');
      showToast('Copied');
    });
    document.getElementById('applyImportBtn').addEventListener('click', () => {
      try {
        const obj = JSON.parse(document.getElementById('exportArea').value);
        if (!obj || !obj.name || !Array.isArray(obj.words)) return alert('Invalid list JSON');
        obj.id = uid('list');
        data.lists.push(obj);
        saveDataLocal();
        renderAll();
        showToast('Imported');
      } catch (e) { alert('Invalid JSON'); }
    });

    // --- Learning Session Logic ---
    function startLearning() {
      const list = data.lists.find(x => x.id === currentListId);
      if (!list) return alert('Select a list');
      const mode = document.getElementById('modeSelect').value;
      const excludeDisabled = document.getElementById('excludeDisabled').checked;
      const randomize = document.getElementById('randomize').checked;
      let pool = list.words.slice();
      if (excludeDisabled) pool = pool.filter(w => w.enabled);
      if (mode === 'listening' || mode === 'writing') pool = pool.filter(w => !w.learned);
      if (mode === 'review') pool = pool.filter(w => w.learned);
      if (pool.length === 0) return alert('No words match selection.');
      if (randomize) shuffle(pool);
      session = { pool: pool.slice(), index: 0, correct: 0, wrong: 0, newlyLearned: [], mode };
      session.showMeaning = (mode === 'writing' || mode === 'review');
      document.getElementById('learningArea').style.display = 'block';
      document.getElementById('manageArea').style.display = 'none';
      document.getElementById('studyAnswer').value = '';
      updateSessionUI();
      speakCurrent();
      document.getElementById('studyAnswer').focus();
    }
    document.getElementById('startLearningBtn').onclick = () => startLearning();
    document.getElementById('stopSessionBtn').onclick = () => { if (confirm('Stop session?')) endSession(); }
    async function endSession() {
      if (!session) return;
      alert(`Session ended. Correct: ${session.correct}, Wrong: ${session.wrong}, Newly learned: ${session.newlyLearned.length}`);
      session = null;
      wrongWords = [];
      document.getElementById('learningArea').style.display = 'none';
      document.getElementById('manageArea').style.display = 'block';
      renderCurrentList();
      // T·ª± ƒë·ªông push k·∫øt qu·∫£ l√™n GitHub
      try {
        const cfg = getGitHubConfig();
        if (cfg) {
          await pushToGitHub('Sync after learning session');
          showToast('Session results synced to GitHub');
        }
      } catch (e) {
        showToast('GitHub sync failed: ' + e.message);
      }
    }
    function updateSessionUI() {
      if (!session) return;
      document.getElementById('sessionProgress').textContent = `${session.index + 1} / ${session.pool.length}`;
      const cw = session.pool[session.index];
      document.getElementById('studyWord').textContent = session.mode === 'writing' ? (cw.meaning || '‚Äî') : (session.showMeaning ? (cw.meaning || '‚Äî') : 'üîä Listen and type');
      document.getElementById('studyMeaning').textContent = session.showMeaning ? cw.meaning || '' : '';
      document.getElementById('sessionResult').textContent = `Correct: ${session.correct} ‚Ä¢ Wrong: ${session.wrong}`;
    }
    function speakCurrent() {
      if (!session) return;
      const cw = session.pool[session.index];
      lastWord = cw.word; // L∆∞u l·∫°i t·ª´ v·ª´a h·ªçc
      speak(cw.word);
    }
    document.getElementById('playWordBtn').onclick = () => { if (session) speakCurrent(); }
    document.getElementById('studyAnswer').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        checkAnswer();
      }
    });
    document.getElementById('markCorrectBtn').onclick = () => { markResult(true); }
    document.getElementById('markWrongBtn').onclick = () => { markResult(false); }
    function checkAnswer() {
      if (!session) return;
      const input = document.getElementById('studyAnswer').value.trim();
      const cw = session.pool[session.index];
      const correct = cw.word.trim().toLowerCase();
      if (input.toLowerCase() === correct) {
        markResult(true);
      } else {
        markResult(false);
      }
    }
    function markResult(isCorrect) {
      const cw = session.pool[session.index];
      const list = data.lists.find(x => x.id === currentListId);
      const actual = list.words.find(w => w.id === cw.id);
      const streakNeeded = parseInt(document.getElementById('streakNeeded').value) || 3;
      if (isCorrect) {
        session.correct++;
        actual.correctStreak = (actual.correctStreak || 0) + 1;
        if (actual.correctStreak >= streakNeeded && !actual.learned) {
          actual.learned = true;
          session.newlyLearned.push(actual);
        }
        sessionResultFlash('Correct', true);
      } else {
        session.wrong++;
        actual.correctStreak = 0;
        // L∆∞u l·∫°i ƒë√°p √°n ng∆∞·ªùi d√πng
        cw.userInput = document.getElementById('studyAnswer').value.trim();
        wrongWords.push(cw);
        sessionResultFlash(`Wrong ‚Äî answer: ${actual.word}`, false);
      }
      saveDataLocal();
      if (session.index < session.pool.length - 1) {
        session.index++;
        document.getElementById('studyAnswer').value = '';
        updateSessionUI();
        setTimeout(() => { speakCurrent(); document.getElementById('studyAnswer').focus(); }, 800);
      } else {
        showWrongWordsModal();
      }
    }

    function showWrongWordsModal() {
      if (!wrongWords.length) {
        endSession();
        return;
      }
      const modal = document.getElementById('wrongWordsModal');
      const listDiv = document.getElementById('wrongWordsList');
      // Hi·ªÉn th·ªã t·ª´ sai v√† ƒë√°p √°n ƒë√£ g√µ (gi·∫£ s·ª≠ wrongWords l∆∞u th√™m thu·ªôc t√≠nh userInput)
      listDiv.innerHTML = '<ul>' + wrongWords.map(w =>
        `<li>
      <strong>${escapeHtml(w.word)}</strong> ‚Äî ${escapeHtml(w.meaning)}
      <span style="color:#b91c1c; margin-left:10px">B·∫°n ƒë√£ g√µ: ${escapeHtml(w.userInput || '')}</span>
    </li>`
      ).join('') + '</ul>';
      modal.classList.remove('hidden');
    }

    document.getElementById('closeWrongWordsBtn').onclick = () => {
      document.getElementById('wrongWordsModal').classList.add('hidden');
      endSession();
    };

    document.getElementById('retryWrongWordsBtn').onclick = () => {
      if (!wrongWords.length) return;
      session = {
        pool: wrongWords.slice(),
        index: 0,
        correct: 0,
        wrong: 0,
        newlyLearned: [],
        mode: 'writing',
        showMeaning: true
      };
      wrongWords = [];
      document.getElementById('wrongWordsModal').classList.add('hidden');
      document.getElementById('learningArea').style.display = 'block';
      document.getElementById('manageArea').style.display = 'none';
      document.getElementById('studyAnswer').value = '';
      updateSessionUI();
      speakCurrent();
      document.getElementById('studyAnswer').focus();
    };

    // --- Speech ---
    let voices = [];
    function loadVoices() {
      voices = speechSynthesis.getVoices().filter(v => v.lang.startsWith('en') || v.lang.startsWith('en-'));
      if (!voices.length) voices = speechSynthesis.getVoices();
    }
    loadVoices();
    window.speechSynthesis.onvoiceschanged = loadVoices;
    function speak(text) {
      if (!('speechSynthesis' in window)) { alert('SpeechSynthesis not supported'); return; }
      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'en-US';
      // ∆Øu ti√™n gi·ªçng Google US English ho·∫∑c Natural n·∫øu c√≥
      let bestVoice = voices.find(v => v.name === 'Google US English')
        || voices.find(v => /natural|premium/i.test(v.name))
        || voices.find(v => v.lang === 'en-US')
        || voices[0];
      if (bestVoice) u.voice = bestVoice;
      u.rate = 1;    // t·ªëc ƒë·ªô b√¨nh th∆∞·ªùng
      u.pitch = 1.1; // cao ƒë·ªô h∆°i cao cho t·ª± nhi√™n
      speechSynthesis.cancel();
      speechSynthesis.speak(u);
    }

    // --- Utils ---
    function shuffle(a) {
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
    }
    function escapeHtml(s) {
      if (!s) return '';
      return s.replace(/[&\"'<>]/g, c => ({ '&': '&amp;', '\"': '&quot;', "'": "&#39;", '<': '&lt;', '>': '&gt;' }[c]));
    }

    // --- Init ---
    loadDataLocal();
    (async () => {
      const cfg = getGitHubConfig();
      if (cfg) {
        updateGithubStatus(true);
        try {
          const remote = await ghGetFile(cfg.username, cfg.repo, cfg.branch, DATA_PATH, cfg.token);
          if (remote && remote.content) {
            const remoteStr = decodeURIComponent(escape(atob(remote.content.replace(/\n/g, ''))));
            const remoteObj = JSON.parse(remoteStr);
            const backupKey = STORAGE_KEY + '_backup_' + new Date().toISOString();
            localStorage.setItem(backupKey, localStorage.getItem(STORAGE_KEY) || '');
            data = remoteObj;
            saveDataLocal();
            showToast('Loaded data from GitHub');
          }
        } catch (e) { console.warn('Load remote failed', e); updateGithubStatus(false); }
      }
      if (!currentListId && data.lists.length) currentListId = data.lists[0].id;
      ensureSample();
      renderAll();
    })();

    function ensureSample() {
      if (data.lists.length === 0) {
        const listId = uid('list');
        data.lists.push({
          id: listId,
          name: 'Sample - Basic',
          words: [
            { id: uid('w'), word: 'apple', meaning: 't√°o', correctStreak: 0, learned: false, enabled: true },
            { id: uid('w'), word: 'banana', meaning: 'chu·ªëi', correctStreak: 0, learned: false, enabled: true },
            { id: uid('w'), word: 'orange', meaning: 'cam', correctStreak: 0, learned: false, enabled: true },
            { id: uid('w'), word: 'book', meaning: 's√°ch', correctStreak: 0, learned: false, enabled: true },
            { id: uid('w'), word: 'table', meaning: 'b√†n', correctStreak: 0, learned: false, enabled: true }
          ]
        });
        saveDataLocal();
      }
    }
    function toggleEnabled(wordId, enabled) {
      const list = data.lists.find(x => x.id === currentListId);
      if (!list) return;
      const w = list.words.find(x => x.id === wordId);
      if (!w) return;
      w.enabled = enabled;
      saveDataLocal();
      renderCurrentList();
    }

    document.addEventListener('keydown', function (e) {
      // N·∫øu ƒëang ·ªü khu v·ª±c h·ªçc v√† nh·∫•n Ctrl
      if (document.getElementById('learningArea').style.display !== 'none') {
        if (e.ctrlKey && !e.shiftKey && !e.altKey && e.key === 'Control') {
          // Ph√°t l·∫°i t·ª´ v·ª´a h·ªçc
          if (lastWord) speak(lastWord);
        }
        // N·∫øu mu·ªën d√πng Ctrl+R ƒë·ªÉ ph√°t l·∫°i t·ª´ v·ª´a h·ªçc (tr√°nh reload trang)
        if (e.ctrlKey && e.key.toLowerCase() === 'r') {
          e.preventDefault();
          if (lastWord) speak(lastWord);
        }
      }
    });

    function sessionResultFlash(msg, isCorrect) {
      const el = document.getElementById('sessionResult');
      el.textContent = msg;
      el.style.color = isCorrect ? '#2563eb' : '#b91c1c';
      setTimeout(() => {
        el.textContent = `Correct: ${session ? session.correct : 0} ‚Ä¢ Wrong: ${session ? session.wrong : 0}`;
        el.style.color = '';
      }, 1200);
    }

    function applyFullLang(lang) {
      const L = LANG_UI[lang];
      // Sidebar
      document.querySelector('.brand').textContent = lang === 'vi' ? 'Luy·ªán t·ª´ v·ª±ng v5' : 'Vocab Trainer v5';
      document.getElementById('newListName').placeholder = lang === 'vi' ? 'T√™n danh s√°ch m·ªõi' : 'New list name';
      document.getElementById('createListBtn').textContent = lang === 'vi' ? 'T·∫°o' : 'Create';
      document.getElementById('importBtn').textContent = lang === 'vi' ? 'Nh·∫≠p JSON' : 'Import JSON';
      document.getElementById('connectGithubBtn').textContent = lang === 'vi' ? 'üîó K·∫øt n·ªëi GitHub' : 'üîó Connect GitHub';
      document.getElementById('syncNowBtn').textContent = lang === 'vi' ? 'üíæ ƒê·ªìng b·ªô' : 'üíæ Sync Now';
      document.getElementById('footerTip').innerHTML = lang === 'vi'
        ? 'M·∫πo: Khi b·∫≠t ƒë·ªìng b·ªô GitHub, d·ªØ li·ªáu n·∫±m ·ªü repo <code>data/vocab_data.json</code>.'
        : 'Tip: With GitHub Sync enabled, data file lives in your repo at <code>data/vocab_data.json</code>.';

      // Main controls
      document.getElementById('exportBtn').textContent = lang === 'vi' ? 'Xu·∫•t JSON' : 'Export JSON';
      document.getElementById('startLearningBtn').textContent = L.startLearningBtn;
      document.getElementById('modeSelect').options[0].text = lang === 'vi' ? 'Nghe' : 'Listening';
      document.getElementById('modeSelect').options[1].text = lang === 'vi' ? 'Vi·∫øt' : 'Writing';
      document.getElementById('modeSelect').options[2].text = lang === 'vi' ? '√în t·∫≠p ƒë√£ h·ªçc' : 'Review Learned';
      document.getElementById('modeSelect').options[3].text = lang === 'vi' ? 'H·ªón h·ª£p' : 'Mixed';
      document.getElementById('excludeDisabled').nextSibling.textContent = lang === 'vi' ? 'B·ªè qua t·ª´ t·∫Øt' : 'Exclude disabled';
      document.getElementById('randomize').nextSibling.textContent = lang === 'vi' ? 'Ng·∫´u nhi√™n' : 'Randomize';

      // Add/Edit
      document.getElementById('wordInput').placeholder = lang === 'vi' ? 'T·ª´ ti·∫øng Anh' : 'English word';
      document.getElementById('meaningInput').placeholder = lang === 'vi' ? 'Nghƒ©a ti·∫øng Vi·ªát ‚Äî ƒë·ªÉ tr·ªëng ƒë·ªÉ t·ª± d·ªãch' : 'Meaning (Vietnamese) ‚Äî leave empty to auto-translate';
      document.getElementById('addWordBtn').textContent = lang === 'vi' ? 'Th√™m' : 'Add';
      document.getElementById('updateWordBtn').textContent = lang === 'vi' ? 'C·∫≠p nh·∫≠t' : 'Update';
      document.getElementById('resetAllProgressBtn').textContent = lang === 'vi' ? 'ƒê·∫∑t l·∫°i ti·∫øn ƒë·ªô' : 'Reset all progress';
      document.getElementById('lblOptions').textContent = L.lblOptions;
      document.getElementById('copyExportBtn').textContent = lang === 'vi' ? 'Sao ch√©p' : 'Copy';
      document.getElementById('applyImportBtn').textContent = lang === 'vi' ? '√Åp d·ª•ng nh·∫≠p' : 'Apply Import';
      document.getElementById('exportArea').placeholder = lang === 'vi' ? 'JSON xu·∫•t hi·ªán ·ªü ƒë√¢y' : 'Exported JSON appears here';

      // Table headers
      document.getElementById('thWord').textContent = lang === 'vi' ? 'T·ª´' : 'Word';
      document.getElementById('thMeaning').textContent = lang === 'vi' ? 'Nghƒ©a (VI)' : 'Meaning (VI)';
      document.getElementById('thStreak').textContent = lang === 'vi' ? 'Chu·ªói ƒë√∫ng' : 'Streak';
      document.getElementById('thLearned').textContent = lang === 'vi' ? 'ƒê√£ h·ªçc' : 'Learned';
      document.getElementById('thEnabled').textContent = lang === 'vi' ? 'B·∫≠t' : 'Enabled';

      // Learning area
      document.getElementById('lblLearningSession').textContent = L.lblLearningSession;
      document.getElementById('stopSessionBtn').textContent = lang === 'vi' ? 'D·ª´ng l·∫°i' : 'Stop';
      document.getElementById('playWordBtn').textContent = lang === 'vi' ? 'üîä Ph√°t' : 'üîä Play';
      document.getElementById('markCorrectBtn').textContent = lang === 'vi' ? 'ƒê√∫ng' : 'Mark Correct';
      document.getElementById('markWrongBtn').textContent = lang === 'vi' ? 'Sai' : 'Mark Wrong';
      document.getElementById('studyAnswer').placeholder = lang === 'vi' ? 'G√µ t·ª´ b·∫°n nghe v√† nh·∫•n Enter' : 'Type the word you hear and press Enter';

      // Wrong words modal
      document.querySelector('#wrongWordsModal h3').textContent = lang === 'vi' ? 'C√°c t·ª´ b·∫°n sai' : 'Words you got wrong';
      document.getElementById('closeWrongWordsBtn').textContent = lang === 'vi' ? 'ƒê√≥ng' : 'Close';
      document.getElementById('retryWrongWordsBtn').textContent = lang === 'vi' ? 'H·ªçc l·∫°i t·ª´ sai' : 'Retry Wrong Words';

      // GitHub modal
      document.querySelector('#githubModal h3').textContent = lang === 'vi' ? 'K·∫øt n·ªëi v·ªõi GitHub' : 'Connect to GitHub';
      document.querySelector('#githubModal .muted-note').innerHTML = lang === 'vi'
        ? 'Ch√∫ng t√¥i s·∫Ω ƒë·ªçc/ghi <code>data/vocab_data.json</code> trong repo c·ªßa b·∫°n. Cung c·∫•p token c√° nh√¢n c√≥ quy·ªÅn <code>contents: write</code>.'
        : "We'll read/write <code>data/vocab_data.json</code> in your repo. Provide a personal access token with <code>contents: write</code> permission.";
      document.querySelector('#githubModal label:nth-of-type(1)').textContent = lang === 'vi' ? 'T√™n ng∆∞·ªùi d√πng GitHub' : 'GitHub username';
      document.querySelector('#githubModal label:nth-of-type(2)').textContent = lang === 'vi' ? 'T√™n repository' : 'Repository name';
      document.querySelector('#githubModal label:nth-of-type(3)').textContent = lang === 'vi' ? 'Nh√°nh' : 'Branch';
      document.querySelector('#githubModal label:nth-of-type(4)').textContent = lang === 'vi' ? 'Token truy c·∫≠p c√° nh√¢n (PAT)' : 'Personal Access Token (PAT)';
      document.getElementById('ghCancel').textContent = lang === 'vi' ? 'H·ªßy' : 'Cancel';
      document.getElementById('ghSave').textContent = lang === 'vi' ? 'L∆∞u & K·∫øt n·ªëi' : 'Save & Connect';
    }

    // G·ªçi h√†m n√†y khi ƒë·ªïi ng√¥n ng·ªØ
    document.getElementById('uiLang').addEventListener('change', e => {
      const lang = e.target.value;
      localStorage.setItem(LANG_KEY, lang);
      applyLang(lang);
      applyFullLang(lang); // Th√™m d√≤ng n√†y
    });

    // Khi kh·ªüi t·∫°o c≈©ng g·ªçi
    applyFullLang(savedLang);
  </script>
</body>

</html>